{"version":3,"sources":["../../../../src/modules/Thumbnail/connectors/getPostThumbnail.js"],"names":["Postmeta","Post","settings","postId","findOne","where","post_id","meta_key","then","res","amazonS3","publicSettings","metaKeys","push","id","Number","dataValues","meta_value","include","model","Op","in","limit","post","Sequelize"],"mappings":";;;;;;kBAKe,UAAUA,QAAV,EAAoBC,IAApB,EAA0BC,QAA1B,EAAoC;AACjD,SAAO,UAASC,MAAT,EAAiB;AACtB,WAAOH,SAASI,OAAT,CAAiB;AACtBC,aAAO;AACLC,iBAASH,MADJ;AAELI,kBAAU;AAFL;AADe,KAAjB,EAKJC,IALI,CAKC,eAAO;AACb,UAAIC,GAAJ,EAAS;AAAA,YACAC,QADA,GACYR,SAASS,cADrB,CACAD,QADA;;AAEP,YAAME,WAAWF,WAAW,CAAC,eAAD,CAAX,GAA+B,CAAC,mBAAD,CAAhD;AACAE,iBAASC,IAAT,CAAc,yBAAd;;AAEA,eAAOZ,KAAKG,OAAL,CAAa;AAClBC,iBAAO;AACLS,gBAAIC,OAAON,IAAIO,UAAJ,CAAeC,UAAtB;AADC,WADW;AAIlBC,mBAAS;AACPC,mBAAOnB,QADA;AAEPK,mBAAO;AACLE,4CACGa,GAAGC,EADN,EACWT,QADX;AADK,aAFA;AAOPU,mBAAO;AAPA;AAJS,SAAb,EAaJd,IAbI,CAaE,gBAAQ;AACf,iBAAO,8BAAee,IAAf,EAAqBrB,QAArB,CAAP;AACD,SAfM,CAAP;AAgBD;AACD,aAAO,IAAP;AACD,KA7BM,CAAP;AA8BD,GA/BD;AAgCD,C;;AAtCD;;;;AACA;;;;;;;;AAEA,IAAMkB,KAAKI,oBAAUJ,EAArB","file":"getPostThumbnail.js","sourcesContent":["import Sequelize from 'sequelize'\r\nimport shapeThumbnail from '../shapeThumbnail'\r\n\r\nconst Op = Sequelize.Op\r\n\r\nexport default function (Postmeta, Post, settings) {\r\n  return function(postId) {\r\n    return Postmeta.findOne({\r\n      where: {\r\n        post_id: postId,\r\n        meta_key: '_thumbnail_id'\r\n      }\r\n    }).then(res => {\r\n      if (res) {\r\n        const {amazonS3} = settings.publicSettings\r\n        const metaKeys = amazonS3 ? ['amazonS3_info'] : ['_wp_attached_file']\r\n        metaKeys.push('_wp_attachment_metadata')\r\n\r\n        return Post.findOne({\r\n          where: {\r\n            id: Number(res.dataValues.meta_value)\r\n          },\r\n          include: {\r\n            model: Postmeta,\r\n            where: {\r\n              meta_key: {\r\n                [Op.in]: metaKeys\r\n              }\r\n            },\r\n            limit: 2\r\n          }\r\n        }).then( post => {\r\n          return shapeThumbnail(post, settings)\r\n        })\r\n      }\r\n      return null\r\n    })\r\n  }\r\n}"]}