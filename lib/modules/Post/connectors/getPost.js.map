{"version":3,"sources":["../../../../src/modules/Post/connectors/getPost.js"],"names":["Post","postId","name","findOne","where","post_status","Op","or","id","post_name","then","post","dataValues","post_type","children","findAll","attributes","and","post_parent","childPosts","length","map","push","Number","childPost","Sequelize"],"mappings":";;;;;;kBAGe,UAAUA,IAAV,EAAe;AAC5B,SAAO,UAAUC,MAAV,EAAkBC,IAAlB,EAAuB;AAC5B,WAAOF,KAAKG,OAAL,CAAa;AAClBC;AACEC,qBAAa;AADf,SAEGC,GAAGC,EAFN,EAEW,CAAC,EAACC,IAAIP,MAAL,EAAD,EAAe,EAACQ,WAAWP,IAAZ,EAAf,CAFX;AADkB,KAAb,EAKJQ,IALI,CAKC,gBAAQ;AACd,UAAIC,IAAJ,EAAU;AAAA,+BACkBA,KAAKC,UADvB;AAAA,YACAJ,EADA,oBACAA,EADA;AAAA,YACIK,SADJ,oBACIA,SADJ;;AAERF,aAAKC,UAAL,CAAgBE,QAAhB,GAA2B,EAA3B;AACA,eAAOd,KAAKe,OAAL,CAAa;AAClBC,sBAAY,CAAC,IAAD,CADM;AAElBZ,qCACGE,GAAGW,GADN,EACY,CACR,EAACC,aAAaV,EAAd,EADQ,EAER,EAACK,WAAWA,SAAZ,EAFQ,CADZ;AAFkB,SAAb,EAQJH,IARI,CAQC,sBAAc;AACpB,cAAIS,WAAWC,MAAX,GAAoB,CAAxB,EAA2B;AACzBD,uBAAWE,GAAX,CAAe,qBAAa;AAC1BV,mBAAKC,UAAL,CAAgBE,QAAhB,CAAyBQ,IAAzB,CAA8B,EAAEd,IAAIe,OAAOC,UAAUZ,UAAV,CAAqBJ,EAA5B,CAAN,EAA9B;AACD,aAFD;AAGD;;AAED,iBAAOG,IAAP;AACD,SAhBM,CAAP;AAiBD;AACD,aAAO,IAAP;AACD,KA5BM,CAAP;AA6BD,GA9BD;AA+BD,C;;AAnCD;;;;;;;;AACA,IAAML,KAAKmB,oBAAUnB,EAArB","file":"getPost.js","sourcesContent":["import Sequelize from 'sequelize'\r\nconst Op = Sequelize.Op\r\n\r\nexport default function (Post){\r\n  return function (postId, name){\r\n    return Post.findOne({\r\n      where: {\r\n        post_status: 'publish',\r\n        [Op.or]: [{id: postId}, {post_name: name}]\r\n      }\r\n    }).then(post => {\r\n      if (post) {\r\n        const { id, post_type } = post.dataValues\r\n        post.dataValues.children = []\r\n        return Post.findAll({\r\n          attributes: ['id'],\r\n          where: {\r\n            [Op.and]: [\r\n              {post_parent: id},\r\n              {post_type: post_type}\r\n            ]\r\n          }\r\n        }).then(childPosts => {\r\n          if (childPosts.length > 0) {\r\n            childPosts.map(childPost => {\r\n              post.dataValues.children.push({ id: Number(childPost.dataValues.id) })\r\n            })\r\n          }\r\n          \r\n          return post\r\n        })\r\n      }\r\n      return null\r\n    })\r\n  }\r\n}"]}