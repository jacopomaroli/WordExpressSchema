{"version":3,"sources":["../../../../src/modules/Menu/connectors/getMenu.js"],"names":["Post","Postmeta","Terms","TermRelationships","name","findOne","where","slug","include","model","attributes","then","res","menu","id","items","term_id","relationship","wp_term_relationships","postFuncs","x","wp_post","dataValues","menu_order","postMeta","wp_postmeta","map","item","order","parentMenuId","parseInt","meta_key","meta_value","linkedId","itemsWithChildren","children","filter","i"],"mappings":";;;;;;kBAKe,UAAUA,IAAV,EAAgBC,QAAhB,EAA0BC,KAA1B,EAAiCC,iBAAjC,EAAmD;AAChE,SAAO,UAAUC,IAAV,EAAgB;AACrB,WAAOF,MAAMG,OAAN,CAAc;AACnBC,aAAO;AACLC,cAAMH;AADD,OADY;AAInBI,eAAS,CAAC;AACRC,eAAON,iBADC;AAERK,iBAAS,CAAC;AACRC,iBAAOT,IADC;AAERU,sBAAY,CAAC,aAAD,EAAgB,IAAhB,EAAsB,YAAtB,CAFJ;AAGRF,mBAAS,CAAC;AACRC,mBAAOR;AADC,WAAD;AAHD,SAAD;AAFD,OAAD;AAJU,KAAd,EAcJU,IAdI,CAcC,eAAO;AACb,UAAIC,GAAJ,EAAS;AACP,YAAMC,OAAO;AACXC,cAAI,IADO;AAEXV,gBAAMA,IAFK;AAGXW,iBAAO;AAHI,SAAb;AAKAF,aAAKC,EAAL,GAAUF,IAAII,OAAd;AACA,YAAMC,eAAeL,IAAIM,qBAAzB;;AAEA,YAAMC,YAAY,CAChB,mBAAI;AAAA,iBAAKC,EAAEC,OAAP;AAAA,SAAJ,CADgB,EAEhB,mBAAI;AAAA,iBAAKD,EAAEE,UAAP;AAAA,SAAJ,CAFgB,EAGhB,sBAAO;AAAA,iBAAKF,EAAEG,UAAP;AAAA,SAAP,CAHgB,EAIhB,mBAAI,aAAK;AACP,cAAMC,WAAWJ,EAAEK,WAAF,CAAcC,GAAd,CAAkB;AAAA,mBAAKN,EAAEE,UAAP;AAAA,WAAlB,CAAjB;;AAEA,cAAMK,OAAO;AACXb,gBAAIM,EAAEN,EADK;AAEXc,mBAAOR,EAAEG;AAFE,WAAb;;AAKAI,eAAKE,YAAL,GAAoBC,SAAS,oBAC3B,sBAAO;AAAA,mBAAKV,EAAEW,QAAF,KAAe,6BAApB;AAAA,WAAP,CAD2B,EAE3B,mBAAI;AAAA,mBAAKX,EAAEY,UAAP;AAAA,WAAJ,CAF2B,EAG3BR,QAH2B,EAGjB,CAHiB,CAAT,CAApB;;AAKAG,eAAKM,QAAL,GAAgBH,SAAS,oBACvB,sBAAO;AAAA,mBAAKV,EAAEW,QAAF,KAAe,sBAApB;AAAA,WAAP,CADuB,EAEvB,mBAAI;AAAA,mBAAKX,EAAEY,UAAP;AAAA,WAAJ,CAFuB,EAGvBR,QAHuB,EAGb,CAHa,CAAT,CAAhB;;AAKA,iBAAOG,IAAP;AACD,SAnBD,CAJgB,CAAlB;;AA0BA,YAAMZ,QAAQ,oBAAKI,SAAL,EAAgBF,YAAhB,CAAd;;AAEA,YAAMiB,oBAAoB,oBACxB,mBAAI,gBAAQ;AACVP,eAAKQ,QAAL,GAAgBpB,MAAMqB,MAAN,CAAa;AAAA,mBAAKC,EAAER,YAAF,KAAmBF,KAAKb,EAA7B;AAAA,WAAb,CAAhB;AACA,iBAAOa,IAAP;AACD,SAHD,CADwB,EAKxB,sBAAO;AAAA,iBAAQA,KAAKE,YAAL,KAAsB,CAA9B;AAAA,SAAP,CALwB,EAMxBd,KANwB,CAA1B;;AAQAF,aAAKE,KAAL,GAAamB,iBAAb;;AAEA,eAAOrB,IAAP;AACD;AACD,aAAO,IAAP;AACD,KAjEM,CAAP;AAkED,GAnED;AAoED,C;;AA1ED;;;;AACA;;;;AACA;;;;AACA","file":"getMenu.js","sourcesContent":["import flow from 'lodash/fp/flow'\r\nimport filter from 'lodash/fp/filter'\r\nimport map from 'lodash/fp/map'\r\nimport sortBy from 'lodash/fp/sortBy'\r\n\r\nexport default function (Post, Postmeta, Terms, TermRelationships){\r\n  return function (name) {\r\n    return Terms.findOne({\r\n      where: {\r\n        slug: name\r\n      },\r\n      include: [{\r\n        model: TermRelationships,\r\n        include: [{\r\n          model: Post,\r\n          attributes: ['post_parent', 'id', 'menu_order'],\r\n          include: [{\r\n            model: Postmeta\r\n          }]\r\n        }]\r\n      }]\r\n    }).then(res => {\r\n      if (res) {\r\n        const menu = {\r\n          id: null,\r\n          name: name,\r\n          items: null,\r\n        }\r\n        menu.id = res.term_id\r\n        const relationship = res.wp_term_relationships\r\n    \r\n        const postFuncs = [\r\n          map(x => x.wp_post),\r\n          map(x => x.dataValues),\r\n          sortBy(x => x.menu_order),\r\n          map(x => {\r\n            const postMeta = x.wp_postmeta.map(x => x.dataValues)\r\n      \r\n            const item = {\r\n              id: x.id,\r\n              order: x.menu_order\r\n            }\r\n      \r\n            item.parentMenuId = parseInt(flow(\r\n              filter(x => x.meta_key === '_menu_item_menu_item_parent'),\r\n              map(x => x.meta_value)\r\n            )(postMeta)[0])\r\n      \r\n            item.linkedId = parseInt(flow(\r\n              filter(x => x.meta_key === '_menu_item_object_id'),\r\n              map(x => x.meta_value)\r\n            )(postMeta)[0])\r\n      \r\n            return item\r\n          })\r\n        ]\r\n    \r\n        const items = flow(postFuncs)(relationship)\r\n    \r\n        const itemsWithChildren = flow(\r\n          map(item => {\r\n            item.children = items.filter(i => i.parentMenuId === item.id)\r\n            return item\r\n          }),\r\n          filter(item => item.parentMenuId === 0)\r\n        )(items)\r\n    \r\n        menu.items = itemsWithChildren\r\n    \r\n        return menu\r\n      }\r\n      return null\r\n    })\r\n  }\r\n}"]}