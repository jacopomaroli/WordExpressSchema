{"version":3,"sources":["../src/db.js"],"names":["WordExpressDatabase","settings","connection","connect","connectors","getConnectors","models","getModels","privateSettings","database","name","username","password","host","port","Conn","Sequelize","logging","dialect","define","timestamps","freezeTableName","prefix","wp_prefix","Post","Postmeta","User","Terms","TermRelationships","TermTaxonomy","Option","hasMany","foreignKey","belongsTo"],"mappings":"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","file":"db.js","sourcesContent":["import Sequelize from 'sequelize'\r\n\r\n// MODELS\r\nimport PostModel from './modules/Post/model'\r\nimport PostmetaModel from './modules/Postmeta/model'\r\nimport UserModel from './modules/User/model'\r\nimport {TermModel, TermRelationshipModel, TermTaxonomyModel} from './modules/Term/model'\r\nimport OptionModel from './modules/Option/model'\r\n\r\n// CONNECTORS\r\nimport PostConnectors from './modules/Post/connectors'\r\nimport PostmetaConnectors from './modules/Postmeta/connectors'\r\nimport TermConnectors from './modules/Term/connectors'\r\nimport UserConnectors from './modules/User/connectors'\r\nimport MenuConnectors from './modules/Menu/connectors'\r\nimport ThumbnailConnectors from './modules/Thumbnail/connectors'\r\nimport OptionConnectors from './modules/Option/connectors'\r\n \r\nexport default class WordExpressDatabase {\r\n  constructor(settings) {\r\n    this.settings = settings\r\n    this.connection = this.connect(settings)\r\n    this.connectors = this.getConnectors()\r\n    this.models = this.getModels()\r\n  }\r\n\r\n  connect() {\r\n    const { name, username, password, host, port } = this.settings.privateSettings.database\r\n\r\n    const Conn = new Sequelize(\r\n      name,\r\n      username,\r\n      password,\r\n      {\r\n        logging: false,\r\n        dialect: 'mysql',\r\n        host: host,\r\n        port: port || 3306,\r\n        define: {\r\n          timestamps: false,\r\n          freezeTableName: true,\r\n        }\r\n      }\r\n    )\r\n\r\n    return Conn\r\n  }\r\n\r\n  getModels() {\r\n    const prefix = this.settings.privateSettings.wp_prefix\r\n    const Conn = this.connection\r\n\r\n    return {\r\n      Post: PostModel(Conn, prefix),\r\n      Postmeta: PostmetaModel(Conn, prefix),\r\n      User: UserModel(Conn, prefix),\r\n      Terms: TermModel(Conn, prefix),\r\n      TermRelationships: TermRelationshipModel(Conn, prefix),\r\n      TermTaxonomy: TermTaxonomyModel(Conn, prefix),\r\n      Option: OptionModel(Conn, prefix)\r\n    }\r\n  }\r\n\r\n  getConnectors() {\r\n    const models = this.getModels()\r\n    const { Post, Postmeta, Terms, TermRelationships, TermTaxonomy } = models\r\n\r\n    Terms.hasMany(TermRelationships,  {foreignKey: 'term_taxonomy_id'})\r\n    TermRelationships.belongsTo(Terms, {foreignKey: 'term_taxonomy_id'})\r\n    TermRelationships.belongsTo(TermTaxonomy, {foreignKey: 'term_taxonomy_id'})\r\n\r\n    TermRelationships.hasMany(Postmeta, {foreignKey: 'post_id'})\r\n    Postmeta.belongsTo(TermRelationships, {foreignKey: 'post_id'})\r\n\r\n    TermRelationships.belongsTo(Post, {foreignKey: 'object_id'})\r\n\r\n    Post.hasMany(Postmeta, {foreignKey: 'post_id'})\r\n    Postmeta.belongsTo(Post, {foreignKey: 'post_id'})\r\n\r\n    TermTaxonomy.belongsTo(Terms,  {foreignKey: 'term_id'})\r\n\r\n    return {\r\n      ...PostConnectors(models, this.settings),\r\n      ...PostmetaConnectors(models),\r\n      ...TermConnectors(models, this.settings),\r\n      ...UserConnectors(models),\r\n      ...MenuConnectors(models),\r\n      ...ThumbnailConnectors(models, this.settings),\r\n      ...OptionConnectors(models)\r\n    }\r\n  }\r\n}\r\n"]}